<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
 
 <title>BLOG_NAME</title>
 <link href="YOUR_URL/atom.xml" rel="self"/>
 <link href="YOUR_URL"/>
 <updated>2014-06-23T16:15:31-07:00</updated>
 <id>BLOG_URL</id>
 <author>
   <name>BLOG_NAME</name>
 </author>

 
 <entry>
   <title>Default Hash Values in Ruby</title>
   <link href="YOUR_URL/Default%2BHash%2BValues%2BIn%2BRuby.html"/>
   <updated>2014-06-23T00:00:00-07:00</updated>
   <id>BLOG_URL/Default+Hash+Values+In+Ruby</id>
   <content type="html">&lt;h1&gt;Default Hash Values in Ruby&lt;/h1&gt;

&lt;p&gt;I was recently using Ruby Koans to work on some of my core Ruby principles and I learned some neat things about hashes in ruby.&lt;/p&gt;

&lt;p&gt;In Ruby hashes can have default values. Whatever you put in that default will automatically be the value for any nonexistant key.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;hash = Hash.new(&quot;puppies&quot;)&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;means that&lt;/p&gt;

&lt;p&gt;&lt;code&gt;hash[:nonexistantkey] = &quot;puppies&quot;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Ok, that&#39;s pretty straightforward. But what happens when you try to do something more complicated?&lt;/p&gt;

&lt;p&gt;What if you set your default value to an empty array?&lt;/p&gt;

&lt;p&gt;&lt;code&gt;hash = Hash.new([])&lt;/code&gt; As expected &lt;code&gt;hash[:notakey] = []&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;What if you shovel some values into that empty array?&lt;/p&gt;

&lt;p&gt;&lt;code&gt;hash[:one] &amp;lt;&amp;lt; &quot;uno&quot;&lt;/code&gt; As expected &lt;code&gt;hash[:one] = [&quot;uno&quot;]&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;What if you shovel some more values into that array?&lt;/p&gt;

&lt;p&gt;&lt;code&gt;hash[:two] &amp;lt;&amp;lt; [&quot;dos&quot;]&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Here&#39;s where it gets weird. You would now expect&lt;/p&gt;

&lt;p&gt;&lt;code&gt;hash[:two] = [&quot;dos&quot;]&lt;/code&gt; and &lt;code&gt;hash[:one] = [&quot;uno&quot;]&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;but they don&#39;t:&lt;/p&gt;

&lt;p&gt;&lt;code&gt;hash[:one] = [&quot;uno&quot;, &quot;dos&quot;]&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;hash[:two] = [&quot;uno&quot;, &quot;dos&quot;]&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;hash[:notakey] = [&quot;uno&quot;, &quot;dos&quot;]&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;PLUS even after all of this &lt;code&gt;hash = {}&lt;/code&gt;&lt;/p&gt;

&lt;h2&gt;WAT?&lt;/h2&gt;

&lt;p&gt;That default empty array value is not setting each key to it&#39;s own array, it is setting all keys to THE SAME array.  Hash is still equal to an empty hash because you never actually assigned a value to the keys &lt;code&gt;:one&lt;/code&gt; and &lt;code&gt;:two&lt;/code&gt;, you just shovelled everything into the default array which only returns if you input a nonexistant key.&lt;/p&gt;

&lt;p&gt;Okay, so what if instead of using an empty array as the default you use a block that assigns an empty array?&lt;/p&gt;

&lt;p&gt;&lt;code&gt;hash = Hash.new {|hash, key| hash[key] = []}&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;now if you call an unknown key it will evaluate the block and return the answer. So &lt;code&gt;hash[:notakey] = []&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;You might expect it to have the same behavior as above when shovelling values into the array, but it doesn&#39;t. It has the behavior we expected the above to have:&lt;/p&gt;

&lt;p&gt;&lt;code&gt;hash[:one] &amp;lt;&amp;lt; &quot;uno&quot;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;hash[:two] &amp;lt;&amp;lt; &quot;dos&quot;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;now&lt;/p&gt;

&lt;p&gt;&lt;code&gt;hash[:one] = [&quot;uno&quot;]&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;hash[:two] = [&quot;dos&quot;]&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;hash[:notakey] = []&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;code&gt;hash = {:one =&amp;gt; [&quot;uno&quot;], :two =&amp;gt; [&quot;dos&quot;]}&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;The block is assigning each key its own empty array and actually assigns the value instead of just shovelling it into the default array.&lt;/p&gt;

&lt;p&gt;There&#39;s a blog post about all kinds of cool stuff you can do with these techniques &lt;a href=&quot;http://endofline.wordpress.com/2010/12/24/hash-tricks/&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Original problem from &lt;a href=&quot;http://rubykoans.com/&quot;&gt;Ruby Koans&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Original help figuring out what the heck was happening with the default value of empty array thanks to &lt;a href=&quot;http://stackoverflow.com/questions/2698460/strange-ruby-behavior-when-using-hash-new&quot;&gt;this&lt;/a&gt; stack overflow post&lt;/p&gt;
</content>
 </entry>
 
 
</feed>